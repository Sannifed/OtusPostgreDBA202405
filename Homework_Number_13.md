

# Домашнее задание №13


* **Секционировать большую таблицу из демо базы flights.**  

![Альт-текст](Images/HW13/01.png)  
![Альт-текст](Images/HW13/02.png)  
![Альт-текст](Images/HW13/03.png)  
_Создаём таблицы, заполняем их данными и пересобираем статистику по ним._  

![Альт-текст](Images/HW13/04.png)  

_Делаем прямое соединение, выводим результирующую выборку и план запроса._  

_Из плана запроса видно что планировщик выбрал соединение по хешу (Hash Join)._  
_В данном случае для каждой строки таблицы model_bus по ключу хеширования (ключом хеширования являются поля участвующие в условии соединения - Hash Cond) расчитывается хеш-функции, из которых и строится хеш-таблица._  
_Затем зачитываюся строки из таблицы bus. Для каждой прочитанной строки проверяется наличие соответствующих ей строк в хеш-таблице. Найденные соответствия выводятся в результирующую выборку._  
![Альт-текст](Images/HW13/05.png)  

_Делаем левостороннее соединение, выводим результирующую выборку и план запроса._  
_План запроса аналогичен предыдущему._  
![Альт-текст](Images/HW13/06.png)  

_Делаем кросс соединение, выводим результирующую выборку и план запроса._  
_В данном случае планировщик предпочёл использовать соединение вложенным циклом (Nested loop)._  
_Базовый алгоритм соединения вложенным циклом таков. Во внешнем цикле перебираются строки первого набора данных (который называется внешним - в данном случае это таблица bus). Для каждой такой строки во вложенном цикле перебираются строки второго набора (который называется внутренним - в данном случае это таблица model_bus), удовлетворяющие условию соединения. Каждая найденная пара немедленно возвращается как часть результата._  
_В данном случае внутренний набор представлен узлом Materialize. Фактически этот узел возвращает полученные от нижестоящего узла строки, предварительно сохраняя их в памяти (пока размер не превышает work_mem; затем данные начинают сохраняться на диск во временный файл). При повторном обращении узел читает запомненные ранее строки, уже не обращаясь к дочернему узлу. Это позволяет не выполнять повторно сканирование всей таблицы, а прочитать только нужные строки, удовлетворяющие условию._  
![Альт-текст](Images/HW13/07.png)  

_Делаем полное соединение, выводим результирующую выборку и план запроса._   
_Снова используется соединение хешированием (hash join)._  
![Альт-текст](Images/HW13/08.png)  

_Делаем левостороннее соединение плюс прямое соединение, выводим результирующую выборку и план запроса._  
  
![Альт-текст](Images/HW13/09.png)  
![Альт-текст](Images/HW13/10.png)  
  
_Предполагаю, что метрики shared_blks_read и local_blks_read можно использовать подобным образом._  








